substitutions:
  friendly_name: "PicoW Temperature Sensor"

<<: !include device_headers/picow-01.yaml

globals:
  - id: led_activity_enabled
    type: bool
    initial_value: 'true'
    restore_value: yes

switch:
  - platform: gpio
    pin:
      number: LED
      mode: output
    id: LED
  - platform: template
    name: "LED Activity"
    id: led_activity
    optimistic: true
    icon: "mdi:led-strip"
    turn_on_action:
      - globals.set:
          id: led_activity_enabled
          value: 'true'
    turn_off_action:
      - globals.set:
          id: led_activity_enabled
          value: 'false'
      - switch.turn_off: LED

interval:
  - interval: 500ms
    then:
      - if:
          condition:
            and:
              - lambda: 'return id(led_activity_enabled);'
              - not:
                  wifi.connected: {}
          then:
            - switch.toggle: LED
  - interval: 1000ms
    then:
      - if:
          condition:
            and:
              - lambda: 'return id(led_activity_enabled);'
              - wifi.connected: {}
          then:
            - switch.toggle: LED


# I2C bus for sensors
i2c:
  sda: GPIO4
  scl: GPIO5
  scan: true

# BME680 environmental sensor using BSEC2 library (I2C)
# Define the BSEC2 hub component
bme68x_bsec2_i2c:
  id: bme68x_bsec2_hub
  address: 0x77
  model: BME680
  # Optional: you can set operating_age, sample_rate, supply_voltage, etc.

# Sensors that use the hub defined above
sensor:
  - platform: bme68x_bsec2
    bme68x_bsec2_id: bme68x_bsec2_hub
    temperature:
      name: "BME680 Temperature"
    humidity:
      name: "BME680 Humidity"
    pressure:
      name: "BME680 Pressure"
    gas_resistance:
      name: "BME680 Gas Resistance"
    iaq:
      name: "BME680 IAQ"
    iaq_accuracy:
      name: "BME680 IAQ Accuracy"
    iaq_static:
      name: "BME680 Static IAQ"
    co2_equivalent:
      name: "BME680 CO2 Equivalent"
    breath_voc_equivalent:
      name: "BME680 Breath VOC Equivalent"